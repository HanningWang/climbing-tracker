<view class="breakthrough-container">
  <view class="header">
    <text class="title">çªç ´è®°å½•</text>
    <text class="subtitle">è®°å½•æ‚¨çš„æ”€å²©çªç ´å’Œé‡Œç¨‹ç¢‘</text>
  </view>

  <view class="form-container">
    <view class="form-item">
      <text class="label">çªç ´æ ‡é¢˜ <text class="required">*</text></text>
      <input class="input" placeholder="ä¾‹å¦‚ï¼šå®Œæˆäº†ç¬¬ä¸€æ¬¡V5" model:value="{{title}}" />
    </view>

    <view class="form-item">
      <text class="label">çªç ´ç±»å‹</text>
      <picker bindchange="bindTypeChange" value="{{typeIndex}}" range="{{typeArray}}" class="picker">
        <view class="picker-content">
          {{typeArray[typeIndex]}}
          <view class="arrow">â–¼</view>
        </view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">æ—¥æœŸ <text class="required">*</text></text>
      <picker mode="date" value="{{date}}" bindchange="bindDateChange" class="picker">
        <view class="picker-content">
          {{date || 'yyyy/mm/dd'}}
          <text class="calendar-icon">ğŸ“…</text>
        </view>
      </picker>
    </view>

    <view class="form-item">
      <text class="label">åœ°ç‚¹ <text class="optional">(é€‰å¡«)</text></text>
      <input class="input" placeholder="è¾“å…¥çªç ´å‘ç”Ÿçš„åœ°ç‚¹" model:value="{{location}}" />
    </view>

    <view class="form-item">
      <text class="label">å¿ƒå¾—ä½“ä¼š <text class="optional">(é€‰å¡«)</text></text>
      <textarea class="textarea" placeholder="è®°å½•ä¸‹ä½ çš„æ„Ÿå—å’Œç»éªŒ..." model:value="{{experience}}"></textarea>
    </view>

    <button class="submit-btn" bindtap="submitBreakthrough">è®°å½•çªç ´</button>
  </view>

  <!-- çƒŸèŠ±åŠ¨ç”»å®¹å™¨ -->
  <view class="fireworks-container" wx:if="{{showFireworks}}">
    <!-- çƒŸèŠ±ç²’å­ -->
    <view wx:for="{{fireworkElements}}" 
          wx:key="index" 
          class="firework"
          style="left: {{item.left}}vw; top: {{item.top}}vh; width: {{item.size}}px; height: {{item.size}}px; background-color: {{item.color}}; opacity: {{item.opacity}}; animation-duration: {{item.animationDuration}}s; animation-delay: {{item.animationDelay}}s;">
    </view>
    
    <!-- é—ªå…‰æ•ˆæœ -->
    <view wx:for="{{sparkleElements}}" 
          wx:key="index"
          class="sparkle"
          style="left: {{item.left}}vw; top: {{item.top}}vh; width: {{item.size}}px; height: {{item.size}}px; background-color: {{item.color || '#ffffff'}}; animation-duration: {{item.duration || 1}}s; animation-delay: {{item.delay}}s;">
    </view>
  </view>

  <!-- çªç ´è®°å½•åˆ—è¡¨ -->
  <view class="breakthrough-list">
    <view class="list-header" wx:if="{{breakthroughList.length > 0}}">
      <text>çªç ´è®°å½•</text>
      <view class="filter-container">
        <picker mode="date" value="{{filterDate}}" bindchange="bindFilterDateChange" class="date-filter">
          <view class="filter-content">
            <text>ç­›é€‰: {{filterDate || 'å…¨éƒ¨æ—¥æœŸ'}}</text>
            <text class="filter-icon">ğŸ”</text>
          </view>
        </picker>
        <view class="clear-filter" wx:if="{{filterDate}}" bindtap="clearDateFilter">Ã—</view>
      </view>
    </view>
    <view class="breakthrough-card {{item.type === 'æˆç»©' ? 'card-type-achievement' : 'card-type-experience'}}" 
          wx:for="{{filteredBreakthroughList}}" 
          wx:key="id">
      <view class="card-header">
        <view class="card-title">{{item.title}}</view>
        <view class="card-actions">
          <view class="icon-view" bindtap="viewCardDetail" data-id="{{item.id}}">
            <view class="svg-icon">
              <image src="../../assets/eye.svg"/>
            </view>
          </view>
          <view class="icon-delete" bindtap="deleteCard" data-id="{{item.id}}">
            <view class="svg-icon">
              <image src="../../assets/delete.svg"/>
            </view>
          </view>
        </view>
      </view>
      
      <view class="card-content">
        <view class="card-row">
          <view class="card-label">
                <image class="label-icon" src="../../assets/calendar.svg"></image>
                <text>æ—¥æœŸï¼š</text>
              </view>
          <text class="card-value">{{item.date}}</text>
        </view>
        <view class="card-row">
          <view class="card-label">
                <image class="label-icon" src="../../assets/file-digit.svg"></image>
                <text>ç±»å‹ï¼š</text>
              </view>
          <text class="card-type-badge">{{item.type}}</text>
        </view>
      </view>
    </view>
    
    <!-- æ·»åŠ æ— è®°å½•æç¤º -->
    <view class="no-records" wx:if="{{filteredBreakthroughList.length === 0 && filterDate}}">
      <text>{{filterDate}} æ²¡æœ‰çªç ´è®°å½•</text>
      <view class="clear-filter-btn" bindtap="clearDateFilter">æ¸…é™¤ç­›é€‰</view>
    </view>
  </view>

  <!-- è¯¦æƒ…å¡ç‰‡å¼¹çª— -->
  <view class="detail-card-overlay" wx:if="{{showDetailCard}}" bindtap="closeDetailCard">
    <view class="detail-card" catchtap="stopPropagation">
      <view class="detail-card-header">
        <text class="detail-card-title">çªç ´è®°å½•è¯¦æƒ…</text>
        <view class="close-btn" bindtap="closeDetailCard">Ã—</view>
      </view>
      
      <view class="detail-card-content">
        <view class="detail-item">
          <text class="detail-title">{{currentCard.title}}</text>
        </view>
        
        <view class="detail-item">
          <view class="detail-label">
            <image class="label-icon" src="../../assets/calendar.svg"></image>
            <text>æ—¥æœŸï¼š</text>
          </view>
          <text class="detail-value">{{currentCard.date}}</text>
        </view>
        
        <view class="detail-item">
          <view class="detail-label">
            <image class="label-icon" src="../../assets/file-digit.svg"></image>
            <text>ç±»å‹ï¼š</text>
          </view>
          <text class="detail-value">{{currentCard.type}}</text>
        </view>
        
        <view class="detail-item" wx:if="{{currentCard.location}}">
          <view class="detail-label">
            <image class="label-icon" src="../../assets/map-pin.svg"></image>
            <text>åœ°ç‚¹ï¼š</text>
          </view>
          <text class="detail-value">{{currentCard.location}}</text>
        </view>
        
        <view class="detail-item" wx:if="{{currentCard.experience}}">
          <view class="detail-label">
            <image class="label-icon" src="../../assets/award.svg"></image>
            <text>å¿ƒå¾—ä½“ä¼šï¼š</text>
          </view>
          <text class="detail-value">{{currentCard.experience}}</text>
        </view>
      </view>
      
      <view class="detail-card-footer">
        <button class="save-card-btn" bindtap="saveCardToAlbum">
          <image src="../../assets/download.svg"></image>
          <text>ä¿å­˜åˆ†äº«å¡ç‰‡</text>
        </button>
      </view>
    </view>
  </view>

  <!-- ç”¨äºç”Ÿæˆå›¾ç‰‡çš„éšè—canvas -->
  <canvas type="2d" id="cardCanvas" style="width: 300px; height: 400px; position: fixed; left: -1000px; top: -1000px;"></canvas>
</view> 